name: Python Package CI

on:
  pull_request:
    branches:
      - main
      - develop
      - feature/*
    paths:
      - 'package/umt_python/**'
  workflow_dispatch:
permissions:
  pull-requests: write
jobs:
    format:
        name: Run Format Check
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                python-version: ['3.9', '3.10', '3.11', '3.12']
                os: [ubuntu-latest]
        defaults:
          run:
            working-directory: ./package/umt_python
        steps:
            - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
            - name: Install uv
              uses: astral-sh/setup-uv@2ddd2b9cb38ad8efd50337e8ab201519a34c9f24 # v7.1.1
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - name: Run Format Check
              run: make format

    lint:
        name: Run Lint
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                python-version: ['3.9', '3.10', '3.11', '3.12']
                os: [ubuntu-latest]
        defaults:
          run:
            working-directory: ./package/umt_python
        steps:
            - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
            - name: Install uv
              uses: astral-sh/setup-uv@2ddd2b9cb38ad8efd50337e8ab201519a34c9f24 # v7.1.1
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - name: Run Lint
              run: make lint

    typecheck:
        name: Run Type Check
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                python-version: ['3.9', '3.10', '3.11', '3.12']
                os: [ubuntu-latest]
        defaults:
          run:
            working-directory: ./package/umt_python
        steps:
            - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
            - name: Install uv
              uses: astral-sh/setup-uv@2ddd2b9cb38ad8efd50337e8ab201519a34c9f24 # v7.1.1
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - name: Run Type Check
              run: make typecheck

    test:
        name: Run Tests
        runs-on: ${{ matrix.os }}
        strategy:
          matrix:
            python-version: ['3.9', '3.10', '3.11', '3.12']
            os: [ubuntu-latest]
        defaults:
          run:
            working-directory: ./package/umt_python
        steps:
            - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
            - name: Install uv
              uses: astral-sh/setup-uv@2ddd2b9cb38ad8efd50337e8ab201519a34c9f24 # v7.1.1
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - name: Run Tests
              run: make test