name: Python Package CI

on:
  pull_request:
    branches:
      - main
      - develop
      - feature/*
    paths:
      - 'package/umt_python/**'
  workflow_dispatch:
permissions:
  pull-requests: write
jobs:
    format:
        name: Run Format Check
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                python-version: ['3.9', '3.10', '3.11', '3.12']
                os: [ubuntu-latest]
        defaults:
          run:
            working-directory: ./package/umt_python
        steps:
            - uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
            - name: Install uv
              uses: astral-sh/setup-uv@1e862dfacbd1d6d858c55d9b792c756523627244 # v7.1.4
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - name: Run Format Check
              run: make format

    lint:
        name: Run Lint
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                python-version: ['3.9', '3.10', '3.11', '3.12']
                os: [ubuntu-latest]
        defaults:
          run:
            working-directory: ./package/umt_python
        steps:
            - uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
            - name: Install uv
              uses: astral-sh/setup-uv@1e862dfacbd1d6d858c55d9b792c756523627244 # v7.1.4
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - name: Run Lint
              run: make lint

    typecheck:
        name: Run Type Check
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                python-version: ['3.9', '3.10', '3.11', '3.12']
                os: [ubuntu-latest]
        defaults:
          run:
            working-directory: ./package/umt_python
        steps:
            - uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
            - name: Install uv
              uses: astral-sh/setup-uv@1e862dfacbd1d6d858c55d9b792c756523627244 # v7.1.4
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - name: Run Type Check
              run: make typecheck

    test:
        name: Run Tests
        runs-on: ${{ matrix.os }}
        strategy:
          matrix:
            python-version: ['3.9', '3.10', '3.11', '3.12']
            os: [ubuntu-latest]
        defaults:
          run:
            working-directory: ./package/umt_python
        steps:
            - uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
            - name: Install uv
              uses: astral-sh/setup-uv@1e862dfacbd1d6d858c55d9b792c756523627244 # v7.1.4
              with:
                  enable-cache: true
                  python-version: ${{ matrix.python-version }}
            - name: Run Tests
              run: make test