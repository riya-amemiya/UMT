name: Wasm Plugin CI
permissions:
  contents: read

on:
    pull_request:
      branches:
        - main
        - develop
        - feature/*
      paths:
        - 'package/umt_wasm/src/**'
    workflow_dispatch:

jobs:
    build:
        name: Build Package
        runs-on: ubuntu-latest
        defaults:
          run:
            working-directory: ./package/umt_wasm
        steps:
        - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
        - uses: ./.github/actions/cache_cargo
        - name: Build Package
          run: cargo build
    test:
      name: Run Tests
      runs-on: ubuntu-latest
      defaults:
        run:
          working-directory: ./package/umt_wasm
      steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
      - uses: ./.github/actions/cache_cargo
      - name: Run Tests
        run: cargo test --all -- --nocapture
      needs: build